<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    body {
      font-size: 20px; 
    }
    .character-card {
      border: 1px solid #cccccc; 
      padding: 5px;
      margin: 35px 0 5px 5px;
    }
    .name {
      border-right: 1px solid #cccccc; 
      padding-right: 10px;
      margin-right: 10px;
      margin-bottom: 15px; 
      padding-bottom: 10px;
    }
    .area {
      margin-bottom: 5px; 
      padding-bottom: 4px;
    }
    .goRace {
      position: fixed;
      bottom: 5%;
      right: 8%; 
    }
    .large-button {
            font-size: 24px;  /* ã“ã®å€¤ã‚’èª¿æ•´ã—ã¦ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã®å¤§ãã•ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ */
            padding: 10px 24px;  /* ã“ã®å€¤ã‚’èª¿æ•´ã—ã¦ãƒœã‚¿ãƒ³è‡ªä½“ã®å¤§ãã•ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ */
        }
    .weather {
      position: absolute;
      top: 5%;
      right: 30%;
      text-align: center; 
    }
    .small-margin {
      margin-bottom: 10px;
    }
    .allArea {
      height: 130px;
      width: 760px;
      /* margin-bottom: 5px;
      padding-bottom: 4px; */
    }
  </style>
</head>
<body>
  <div class="container-fluid"> 
    <div class="row">
      <div class="col-4 text-left">
        <h2 class="my-4">å‡ºèµ°ã‚¨ãƒ¢ãƒ¢ãƒ³ä¸€è¦§</h2>
      </div>
      <div class="col-4 text-center weather">
        <span class="my-2" style="font-size: 20px;">ãƒ¬ãƒ¼ã‚¹æ°—å€™ã€€</span>
        <span id="weatherAndTime" class="my-4" style="font-size: 30px;"></span>
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="character-card mx-2 text-center">
        <div class="d-flex justify-content-between allArea">
          <div class="mb-0 name">
            <p class="mb-0"><strong style="font-size: 90px;">{{ horse.emoji }}</strong></p>
          </div>
          <div class="stats" style="width: 600px; height: 1px;">
            <p class="mb-0 area" style="font-size: 30px;"><strong>{{ horse.name }}</strong></p>
            <p class="small-margin">ğŸš©ã‚¹ã‚¿ãƒŸãƒŠï¼š <span style="font-size: 25px;">{{ horse.stamina }}</span>ã€€ã€€ ğŸ‘Ÿã‚¹ãƒ”ãƒ¼ãƒ‰ï¼š <span style="font-size: 25px;">{{ horse.speed }}</span>ã€€ã€€ ğŸ”–é‹ï¼š <span style="font-size: 25px;">{{ horse.luck }}</span></p>
            <p class="small-margin">ç‰¹æ€§ï¼š
              {% for trait in horse.traits.all %}
                {% if forloop.first %}
                  {{ trait.name }}
                {% else %}
                  , {{ trait.name }}
                {% endif %}
              {% endfor %}
            </p>
          </div>
        </div>
      </div>
    </div>
    {% for cpu_horse in cpu_horses %}
    <div class="row justify-content-center">
      <div class="character-card mx-2 text-center">
        <div class="d-flex justify-content-between allArea">
          <div class="mb-0 name">
            <p class="mb-0 small-margin" style="width: 200;"><strong style="font-size: 90px;">{{ cpu_horse.emoji }}</strong></p>
          </div>
          <div class="stats" style="width: 600px; height: 1px;">
            <p class="mb-0 area" style="font-size: 30px;"><strong>{{ cpu_horse.name }}</strong></p>
            <p class="small-margin">ğŸš©ã‚¹ã‚¿ãƒŸãƒŠï¼š <span style="font-size: 25px;">{{ cpu_horse.stamina }}</span>ã€€ã€€ ğŸ‘Ÿã‚¹ãƒ”ãƒ¼ãƒ‰ï¼š <span style="font-size: 25px;">{{ cpu_horse.speed }}</span>ã€€ã€€ ğŸ”–é‹ï¼š <span style="font-size: 25px;">{{ cpu_horse.luck }}</span></p>
            <p class="small-margin" style="font-size: 18px;">ç‰¹æ€§ï¼š
              {% for trait in cpu_horse.traits.all %}
                {% if forloop.first %}
                  {{ trait.name }}
                {% else %}
                  , {{ trait.name }}
                {% endif %}
              {% endfor %}
            </p>    
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    <div id="character-cards">
      <!-- ã“ã“ã«JavaScriptã§ç”Ÿæˆã—ãŸHTMLè¦ç´ ãŒè¿½åŠ ã•ã‚Œã¾ã™ -->
    </div>

    <div class="d-flex justify-content-center align-items-center" >
      <button class="goRace btn btn-primary large-button" id="raceButton" onclick="goToNextPage()">ãƒ¬ãƒ¼ã‚¹ã¸é€²ã‚€</button>
    </div>
  </div>

  <script>

    // å¤©å€™ç”Ÿæˆé–¢æ•°
    function generateWeather(horse, cpu_horses) {
      var weather;
    
      var horseTraits = [ {% for trait in horse.traits.all %}'{{ trait.name }}',{% endfor %}, 
        {% for cpu_horse in cpu_horses %}
          {% for trait in cpu_horse.traits.all %}
            '{{ trait.name }}',
          {% endfor %}
          {% if not forloop.last %}, {% endif %}
        {% endfor %}];
    
    
      // ãƒˆãƒ¬ã‚¤ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦å¤©æ°—ã‚’è¨­å®š
      if ((horseTraits.includes('é›·ç¥')) || (horseTraits.includes('æ™´ã‚Œç”·')) || (horseTraits.includes('é›¨å¥³')) || (horseTraits.includes('æ–°æ½ŸçœŒæ°‘'))) {
        if (horseTraits.includes('é›·ç¥')) {
          weather = 'thunder';
        } else if (horseTraits.includes('æ™´ã‚Œç”·')) {
          weather = "sunny";
        } else if (horseTraits.includes('é›¨å¥³')) {
          weather = 'rain';
        } else if (horseTraits.includes('æ–°æ½ŸçœŒæ°‘')) {
          weather = 'snow';
        }
      } else {
        var weatherNumber = Math.floor(Math.random() * 10) + 1;
        switch(true) {
          case (weatherNumber >= 1 && weatherNumber <= 4):
            weather = "sunny";
            break;
          case (weatherNumber >= 5 && weatherNumber <= 7):
            weather = "rain";
            break;
          case (weatherNumber >= 8 && weatherNumber <= 9):
            weather = "snow";
            break;
          case (weatherNumber == 10):
            weather = "thunder";
            break;
          }
        }
      return weather;
    }

    // æ™‚é–“å¸¯ç”Ÿæˆé–¢æ•°
    function generateTime() {
      var timeNumber = Math.floor(Math.random() * 3) + 1;
      var time;
      switch(timeNumber) {
        case 1:
          time = "morning";
          break;
        case 2:
          time = "noon";
          break;
        case 3:
          time = "night";
          break;
      }
      return time;
    }

    // è‹±èªã®å¤©å€™ã‚’æ—¥æœ¬èªã«å¤‰æ›ã™ã‚‹é–¢æ•°
    function translateWeather(weather) {
      var weatherTranslations = {
        "sunny": "æ™´ã‚Œ",
        "rain": "é›¨",
        "snow": "é›ª",
        "thunder": "é›·"
      };
      return weatherTranslations[weather];
    }

    // è‹±èªã®æ™‚é–“å¸¯ã‚’æ—¥æœ¬èªã«å¤‰æ›ã™ã‚‹é–¢æ•°
    function translateTime(time) {

      var timeTranslations = {
        "morning": "æœ",
        "noon": "æ˜¼",
        "night": "å¤œ"
      };
      return timeTranslations[time];
    }

    // ãƒ¬ãƒ¼ã‚¹ã¸é€²ã‚€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«ãƒ¬ãƒ¼ã‚¹ç”»é¢ã«é·ç§»ã™ã‚‹é–¢æ•°
    function goToNextPage() {
      window.location.href = '/race/uma_uma/{{horse.id}}'; 
    }

    // ç”Ÿæˆã—ãŸå¤©å€™ã¨æ™‚é–“å¸¯ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    var weather = generateWeather("{{horse}}"," {{cpu_horses}}"); 
    var time = generateTime();
    localStorage.setItem('weather', weather);
    localStorage.setItem('time', time);
    
    // ç”Ÿæˆã—ãŸå¤©å€™ã¨æ™‚é–“å¸¯ã‚’è¡¨ç¤º
    document.getElementById('weatherAndTime').innerText = translateWeather(weather) + " / " + translateTime(time);

  </script>
</body>
</html>